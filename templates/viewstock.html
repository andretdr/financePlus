{% extends "layout.html" %}

{% block title %}
    View Stock Page
{% endblock %}


{% block body %}

    <!-- Storing the data for this stock page -->
    <input type="hidden" id="datadump" name="datadump" value="{{ data }}">

    <div id="viewstockbody">
        <div>
            <div id="viewlogo">
            </div>

            <div id="buyhideme">
                <div class="buysellmenu">
                    BUY
                    <div id="buydollarsformcontainer">
                        <div id="buydollarsform">
                            $<input type="number" id="viewbuydollars" name="viewbuydollars" min='0' placeholder="0.00" oninput="validity.valid||(value='');">
                        </div>
                    </div>
                    <div id="buydollarsbuttoncontainer">
                        <div id="buydollarsbutton">

                            <button onclick="buysellview.buyindollars()">Buy in Dollars</button>
                        </div>
                    </div>

                    <div>
                        ----------- or -------------

                    </div>

                    <div id="buysharesformcontainer">
                        <div id="buysharesform">
                            <input type="number" id="viewbuyshares" name="viewbuyshares" min='0' placeholder="0" oninput="validity.valid||(value='');">share(s)
                        </div>
                    </div>
                    <div id="buysharesbuttoncontainer">
                        <div id="buysharesbutton">

                            <button onclick="buysellview.buyinshares()">Buy in Shares</button>
                        </div>
                    </div>

                    <div>
                        <div>
                            Current Price : $<data id="buycurrentprice"></data></br>
                            
                            <div id="buytype">
                            </div>

                            <p>Shares in holdings : <data id="buyquantity"> share(s)</data></p>
                            <p>Cash Available : $<data id="buycash"></data></p>

                            <div id="buystatus">
                            </div>

                        </div>
                    </div>
                    <button onclick="viewview.buy()">Buy</button>
                    <button onclick="buysellview.closeBuySellMenu()">Cancel</button>
                </div>
            </div>

            <div id="sellhideme">
                <div class="buysellmenu">
                    SELL
                    <div id="selldollarsformcontainer">
                        <div id="selldollarsform">
                            $<input type="number" id="viewselldollars" name="viewselldollars" min='0' placeholder="0.00" oninput="validity.valid||(value='');">
                        </div>
                    </div>
                    <div id="selldollarsbuttoncontainer">
                        <div id="selldollarsbutton">

                            <button onclick="buysellview.sellindollars()">Sell in Dollars</button>
                        </div>
                    </div>

                    <div>
                        ----------- or -------------
                    </div>

                    <div id="sellsharesformcontainer">
                        <div id="sellsharesform">
                            <input type="number" id="viewsellshares" name="viewsellshares" min='0' placeholder="0" oninput="validity.valid||(value='');">share(s)
                        </div>
                    </div>
                    <div id="sellsharesbuttoncontainer">
                        <div id="sellsharesbutton">

                            <button onclick="buysellview.sellinshares()">Sell in Shares</button>
                        </div>
                    </div>

                    <div>
                        ----------- or -------------
                    </div>

                    <div id="sellcloseformcontainer">
                        <div id="sellcloseform">
                            <input type="checkbox" id="viewsellclose" name="viewsellclose" onclick="buysellview.updatesellclosepage()"/> Close position and sell all shares
                        </div>
                    </div>
                    <div id="sellclosebuttoncontainer">
                        <div id="sellclosebutton">
                            <button onclick="buysellview.sellClose()">Close Position</button>
                        </div>
                    </div>

                    <div>
                        <div>
                            Current Price : $<data id="sellcurrentprice"></data></br>
                            
                            <div id="selltype">
                            </div></br>

                            <p>Shares in holdings : <data id="sellsharestotal"></data></p>
                            <p>Cash Available : $<data id="sellcashtotal"></data></p>

                            <div id="sellstatus"></div>
                        </div>
                    </div>
                    <button onClick="viewview.sell()">Sell</button>


                    <button onclick="buysellview.closeBuySellMenu()">Cancel</button>
                </div>
            </div>

            <div id="viewcanvas">
            </div>

            <div id='viewgraphbuttons'>
            </div>
                <button id="viewgraphday" onclick="viewview.graphButton('1d')">1D</button>
                <button id="viewgraphweek" onclick="viewview.graphButton('1w')">1W</button>
                <button id="viewgraphmonth" onclick="viewview.graphButton('1m')">1M</button>
                <button id="viewgraphthreem" onclick="viewview.graphButton('3m')">3M</button>
                <button id="viewgraphyear" onclick="viewview.graphButton('1y')">1Y</button>

            <div id="viewinfo">
            </div>

            <div id="viewholdings">
            </div>


            <div>
                <button onclick="buysellview.showBuyMenu()">Buy</button> <button id="viewsellbutton" onclick="buysellview.showSellMenu(states)">Sell</button>
            </div>

        </div>
    </div>


    <script src="../static/viewstock.js"></script>
    <script src="../static/buysell.js"></script>
    <script>

        const viewcontroller = new viewController();
        const buysellview = new buySellView(viewcontroller);
        const viewview = new viewView(viewcontroller, buysellview);

        // initialise states
        let states = {'buy':false, 'sell':false, 'bydollars':false, 'byshares':false};

        viewview.renderpage();

        // refresh page every 3 secs
        let interval = 3000;
        const viewpageinterval = setInterval(()=>{viewview.refreshAPIDataServerV()}, interval);

    </script>

{% endblock %}