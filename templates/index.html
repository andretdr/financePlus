{% extends "layout.html" %}

{% block title %}
    Index Page
{% endblock %}

{% block body %}
<main class="page-format page-format--main" id="indexbody">
    <section class="index-body">

        <div class="index-body__heading">
            <h2>My Holdings</h2>
        </div>

        <div class="index-body__holdings" id="index-body__grid-insert" style='visibility:hidden'>
        </div>

        <div class="index-body__summary"  id="index-body__summary-insert" style='visibility:hidden'>
        </div>

    </section>
</main>
{% endblock %}

{% block footer %}
    <section class="footer-bar">

        <!-- 
        <div id="footer-bar__info"></div>
        -->
    </section>

    <input type="hidden" id="datadump" name="datadump" value="{{ data }}">
{% endblock %}

{% block script %}
<script>

    const controller = new indexController();
    const view = new indexView(controller);
    // show the elements only now so they dont pop as much
    document.getElementById("index-body__grid-insert").style.visibility = "visible";
    document.getElementById("index-body__summary-insert").style.visibility = "visible";
    view.refreshHoldingsPage();

    if (controller.returnMarketStatus() == 'open'){
        // refresh page every 8 secs
        let interval = 3000;
        let count = 0;
        const indexpageinterval = setInterval(()=>{

            view.refreshHoldingsPageV();
            // after 30s, increase interval to 6 secs
            if (count == 30){
                clearInterval(indexpageinterval);
            }
            count++;
            }, interval);
    }

</script>
{% endblock %}
